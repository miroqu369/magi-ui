<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MAGI System</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #0a0e27; color: #e0e0e0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', monospace; display: flex; flex-direction: column; height: 100vh; }
    .navbar { background: #1a1f3a; padding: 20px 40px; border-bottom: 1px solid #333; }
    .navbar h1 { font-size: 18px; }
    .container { display: flex; flex: 1; overflow: hidden; }
    .sidebar { width: 260px; background: #1a1f3a; border-right: 1px solid #333; padding: 20px; overflow-y: auto; }
    .sidebar-link { display: block; padding: 12px; background: #0d1628; border: 1px solid #333; color: #e0e0e0; margin-bottom: 10px; cursor: pointer; border-radius: 4px; text-decoration: none; }
    .sidebar-link:hover { background: #2a3355; }
    .sidebar-link.active { background: #2a3f5f; border-color: #4a6fa5; }
    .content { flex: 1; padding: 40px; overflow-y: auto; display: none; }
    .content.active { display: block; }
    textarea, input { width: 100%; padding: 12px; background: #1a1f3a; border: 1px solid #333; color: #e0e0e0; border-radius: 4px; margin-bottom: 20px; font-family: inherit; }
    textarea:focus, input:focus { outline: none; border-color: #555; }
    button { width: 100%; padding: 12px; background: #2a3f5f; border: 1px solid #4a6fa5; color: #e0e0e0; cursor: pointer; border-radius: 4px; margin-bottom: 20px; font-weight: 600; }
    button:hover { background: #3a4f7f; }
    .result { background: #1a1f3a; border: 1px solid #333; padding: 20px; border-radius: 4px; min-height: 200px; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
    .box { background: #1a1f3a; border: 1px solid #333; padding: 15px; border-radius: 4px; text-align: center; }
  </style>
</head>
<body>
  <div class="navbar"><h1>âš™ MAGI System</h1></div>
  <div class="container">
    <div class="sidebar">
      <a class="sidebar-link active" onclick="switchPage('consensus')">ğŸ’¬ Consensus</a>
      <a class="sidebar-link" onclick="switchPage('stock')">ğŸ“ˆ Stock</a>
      <a class="sidebar-link" onclick="switchPage('dashboard')">ğŸ“Š Dashboard</a>
    </div>
    <div class="content active" id="consensus">
      <h2>ğŸ’¬ Consensus Mode</h2>
      <textarea id="prompt" placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
      <div class="grid">
        <button onclick="executeMode('consensus')">ğŸ¤ Consensus</button>
        <button onclick="executeMode('integration')">ğŸ”— Integration</button>
        <button onclick="executeMode('synthesis')">âœ“âœ— Synthesis</button>
      </div>
      <div class="result" id="result">çµæœã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
    </div>
    <div class="content" id="stock">
      <h2>ğŸ“ˆ Stock Research</h2>
      <input type="text" id="ticker" placeholder="æ ªå¼ã‚·ãƒ³ãƒœãƒ«ï¼ˆä¾‹: AAPLï¼‰">
      <button onclick="analyzeStock()">ğŸ“Š Analyze</button>
      <div class="result" id="stockResult">çµæœã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
    </div>
    <div class="content" id="dashboard">
      <h2>ğŸ“Š Dashboard</h2>
      <div class="result">ã‚·ã‚¹ãƒ†ãƒ ã¯æ­£å¸¸ã«å‹•ä½œä¸­ã§ã™ã€‚3ã¤ã®AIï¼ˆGemini, Grok, Claudeï¼‰ãŒç¨¼åƒä¸­ã€‚</div>
    </div>
  </div>
  <script>
    let currentMode = 'consensus';
    function switchPage(page) {
      document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
      document.getElementById(page).classList.add('active');
      document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
      event.target.classList.add('active');
    }
    async function executeMode(mode) {
      const prompt = document.getElementById('prompt').value.trim();
      if (!prompt) { alert('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      document.getElementById('result').innerHTML = 'å‡¦ç†ä¸­...';
      try {
        const res = await fetch('/api/query', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ prompt, mode }) });
        const data = await res.json();
        if (mode === 'consensus' && data.candidates) {
          document.getElementById('result').innerHTML = data.candidates.map(c => `<div style="margin-bottom: 20px;"><strong>${c.provider.toUpperCase()}</strong><br>${c.text.substring(0, 300)}...</div>`).join('');
        } else {
          document.getElementById('result').innerHTML = `<strong>æœ€çµ‚å›ç­”</strong><br>${data.final || 'No response'}`;
        }
      } catch (e) {
        document.getElementById('result').innerHTML = `ã‚¨ãƒ©ãƒ¼: ${e.message}`;
      }
    }
    async function analyzeStock() {
      const ticker = document.getElementById('ticker').value.toUpperCase();
      if (!ticker) { alert('æ ªå¼ã‚·ãƒ³ãƒœãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      document.getElementById('stockResult').innerHTML = 'åˆ†æä¸­...';
      try {
        const res = await fetch('/api/stock-analysis', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ ticker, prompt: `${ticker}ã®æ ªä¾¡åˆ†æ` }) });
        const data = await res.json();
        if (data.data?.consensus) {
          const fo = data.data.final_output;
          const c = data.data.consensus;
          document.getElementById('stockResult').innerHTML = `<strong>${ticker} åˆ†æçµæœ</strong><br>åˆ¤å®š: ${fo.decision}<br>ç¢ºåº¦: ${fo.confidence}<br><br><strong>æ¨å¥¨:</strong> ${fo.recommendation}<br><br><strong>ãƒã‚¤ãƒ³ãƒˆ:</strong><br>${c.key_points?.map(p => 'â€¢ ' + p).join('<br>')}`;
        } else {
          document.getElementById('stockResult').innerHTML = 'ã‚¨ãƒ©ãƒ¼';
        }
      } catch (e) {
        document.getElementById('stockResult').innerHTML = `ã‚¨ãƒ©ãƒ¼: ${e.message}`;
      }
    }
  </script>
</body>
</html>
